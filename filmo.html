<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Finding F</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
</head>

<body id="page-top">

    <div id="table"></div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <!--구글 차트 라이브러리 로딩-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!--csv 불러오기, 그리기-->
    <script type="text/javascript">
        google.charts.load('current', {
            'packages': ['table']
        });
        google.charts.setOnLoadCallback(onChartLoaded);

        // onCharLoaded()
        function onChartLoaded() {
            var fileName = "src/data/tenb";
            for (var i = 0; i < 1; i++) {
                var url = fileName + i + '.csv'; // 파일 경로 + sequence + 확장자

                $.ajax({
                    url,
                    dataType: 'text',
                    success: function(data) {
                        var rows = data
                            .split('\n')
                            .map(row => row.split(','))
                        var keys = rows.shift()
                        rows = rows.map(row => {
                            var dict = {}
                            row.forEach((col, i) => dict[keys[i]] = col)
                            return dict
                        })
                        rows = rows.map(row => ({
                            ...row,
                            '관객수': +row['관객수'],
                            '손익분기': +row['손익분기'],
                            '제작비': +row['제작비'],
                            '년도': +row['년도'],
                        }))
                        main(rows)
                    }
                });
            }
        }
        // Main 그리기
        function main(rows) {
            var data = new google.visualization.DataTable();
            data.addColumn('string', '영화명');
            data.addColumn('number', '년도');

            data.addRows(rows
                // [row for row in rows if row['년도'] >= 2018]
                .filter(row => row['년도'] >= 2018)
                // [[row['영화명'], row['년도']] for row in rows]
                .map(row => [row['영화명'], row['년도']])
            );
            var table = new google.visualization.Table(document.querySelector('#table'));
            table.draw(data, {
                showRowNumber: true,
                width: '100%',
                height: '100%'
            });
        }
    </script>

    <!-- Movie Data Api-->
    <!-- <script src="js/KobisOpenAPIRestService.js"></script>
    <script src="https://www.kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchWeeklyBoxOfficeList.json?key=430156241533f1d058c603178cc3ca0e&targetDt=20171110"></script> -->
    <script src="js/script.js"></script>

    <!-- csv 데이터 불러오기 ajax -->
    <script type="text/javascript">
        var xhr;

        function func() {
            xhr = new XMLHttpRequest();
            xhr.open("get", "csvdata.txt", true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        process();
                    } else {
                        alert("요청 실패: " + xhr.status);
                    }
                }
            }
            xhr.send(null);
        }

        function process() {
            var datas = xhr.responseText;
            var rowData = datas.split(String.fromCharCode(13)); //행은 cr로 구분 (String.fromCharCode(13))
            str = "";
            for (var i = 0; i < rowData.length; i++) {
                var colData = rowData[i].split(","); //열은 ,로 구분
                for (var j = 0; j < colData.length; j++) {
                    str += colData[j] + " ";
                }
                str += "<br>";
            }
            document.getElementById("disp").innerHTML = str;
        }
    </script>
</body>

</html>